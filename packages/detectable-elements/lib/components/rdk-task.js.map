{"version":3,"sources":["components/rdk-task.js"],"names":["RDKTask","coherence","attribute","type","Number","reflect","count","probability","duration","wait","iti","trials","running","Boolean","direction","lifetime","speed","width","height","rem","NaN","COHERENT","RANDOM","dots","trial","states","state","baseTime","pauseTime","startTime","lastTime","currentDirection","undefined","signals","signal","runner","xScale","yScale","html","parseFloat","getComputedStyleValue","getComputedStyle","document","documentElement","getPropertyValue","window","addEventListener","getDimensions","bind","removeEventListener","changedProperties","setTimeout","isNaN","elementWidth","elementHeight","elementSize","Math","min","margin","top","bottom","left","right","d3","scaleLinear","domain","range","svgUpdate","select","renderRoot","selectAll","data","svgEnter","enter","append","classed","svgMerge","merge","attr","plotEnter","plotMerge","underlayerEnter","underlayerMerge","contentMerge","dotsUpdate","datum","index","overlayerEnter","overlayerMerge","has","now","interval","run","stop","dotUpdate","exit","remove","fixationUpdate","queryUpdate","realTime","currentTime","elapsedTime","frameTime","newTrial","dispatchEvent","CustomEvent","detail","bubbles","random","length","round","t","i","newDot","dot","birth","floor","angle","PI","radius","sqrt","x","cos","y","sin","directionR","dx","dy","distance2","radius2","fixationEnter","dotEnter","queryEnter","text","css","SDTElement","customElements","define"],"mappings":"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","sourcesContent":["\nimport {html, css} from 'lit-element';\nimport * as d3 from 'd3';\n\nimport SDTElement from '../sdt-element';\n\n/*\n  RDKTask element\n  <rdk-task>\n\n  Attributes:\n  Dots; Coherence;\n  # Direction, Speed, Lifetime\n*/\nexport default class RDKTask extends SDTElement {\n  static get properties() {\n    return {\n      coherence: {\n        attribute: 'coherence',\n        type: Number,\n        reflect: true,\n      },\n      count: {\n        attribute: 'count',\n        type: Number,\n        reflect: true,\n      },\n      probability: {\n        attribute: 'probability',\n        type: Number,\n        reflect: true,\n      },\n      duration: {\n        attribute: 'duration',\n        type: Number,\n        reflect: true,\n      },\n      wait: {\n        attribute: 'wait',\n        type: Number,\n        reflect: true,\n      },\n      iti: {\n        attribute: 'iti',\n        type: Number,\n        reflect: true,\n      },\n      trials: {\n        attribute: 'trials',\n        type: Number,\n        reflect: true,\n      },\n      running: {\n        attribute: 'running',\n        type: Boolean,\n        reflect: true,\n      },\n\n      direction: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n      lifetime: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n      speed: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n\n      width: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n      height: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n      rem: {\n        attribute: false,\n        type: Number,\n        reflect: false,\n      },\n    };\n  }\n\n  constructor() {\n    super();\n\n    // Attributes\n    this.coherence = 0.5; // Proportion of dots moving coherently\n    this.count = 100; // Number of dots\n    this.probability = 0.5; // Probability of signal (as opposed to noise)\n    this.duration = 2000; // Duration of stimulus in milliseconds\n    this.wait = 2000; // Duration of wait period for response in milliseconds\n    this.iti = 2000; // Duration of inter-trial interval in milliseconds\n    this.trials = 5; // Number of trials per block\n    this.running = false; // Currently executing block of trials\n\n    // Properties\n    this.direction = -1; // Direction of current trial in degrees\n    this.lifetime = 400; // Lifetime of each dot in milliseconds\n    this.speed = 50; // Rate of dot movement in pixels per second\n\n    this.width = NaN; // Width of component in pixels\n    this.height = NaN; // Height of component in pixels\n    this.rem = NaN; // Pixels per rem for component\n\n    // Private\n    this.COHERENT = 0; // \"Constant\" for index to coherent dots\n    this.RANDOM = 1; // \"Constant\" for index to random dots\n    this.dots = [[], []]; // Array of array of dots\n    this.trial = 0; // Count of current trial\n\n    this.states = ['resetted', 'iti', 'stimulus', 'wait', 'ended']; // Possible states of task\n    this.state = 'resetted'; // Current state of task\n\n    this.baseTime = 0; // Real time, in milliseconds, that the current block started\n    this.pauseTime = 0; // Real time, in milliseconds, that block was paused at\n    this.startTime = 0; // Virtual time, in milliseconds, that current stage of trial started\n    this.lastTime = 0; // Virtual time, in milliseconds, of the most recent frame\n    this.currentDirection = undefined; // Direction in degrees for current trial\n\n    this.signals = ['present', 'absent']; // Possible trial types\n    this.signal = undefined; // Current trial type\n\n    this.runner = undefined; // D3 Interval for frame timing\n    this.xScale = undefined; // D3 Scale for x-axis\n    this.yScale = undefined; // D3 Scale for y-axis\n  }\n\n  static get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: inline-block;\n        }\n\n        .main {\n          width: 100%;\n          height: 100%;\n        }\n\n        .background {\n          fill: var(---color-element-disabled);\n          stroke: none;\n        }\n\n        .outline {\n          fill: none;\n          stroke: var(---color-element-emphasis);\n          stroke-width: 2px;\n        }\n\n        .dot {\n          /* r: 2px; HACK: Firefox does not support CSS SVG Geometry Properties */\n        }\n\n        .dots.coherent {\n          fill: var(---color-background);\n        }\n\n        .dots.random {\n          fill: var(---color-background);\n        }\n\n        .fixation {\n          stroke: var(---color-text);\n          stroke-width: 2px;\n        }\n\n        .query {\n          font-size: 1.75rem;\n          font-weight: 600;\n        }\n      `,\n    ];\n  }\n\n  render() { // eslint-disable-line class-methods-use-this\n    return html``;\n  }\n\n  getDimensions() {\n    this.width = parseFloat(this.getComputedStyleValue('width'), 10);\n    this.height = parseFloat(this.getComputedStyleValue('height'), 10);\n    this.rem = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('font-size'), 10);\n    // console.log(`rdk-task: width = ${this.width}, height = ${this.height}, rem = ${this.rem}`);\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    window.addEventListener('resize', this.getDimensions.bind(this));\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener('resize', this.getDimensions.bind(this));\n    super.disconnectedCallback();\n  }\n\n  firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n\n    // Get the width and height after initial render/update has occurred\n    // HACK Edge: Edge doesn't have width/height until after a 0ms timeout\n    window.setTimeout(this.getDimensions.bind(this), 0);\n  }\n\n  update(changedProperties) {\n    super.update(changedProperties);\n\n    // Bail out if we can't get the width/height/rem\n    if (Number.isNaN(this.width) || Number.isNaN(this.height) || Number.isNaN(this.rem)) {\n      return;\n    }\n\n    const elementWidth = this.width;\n    const elementHeight = this.height;\n    const elementSize = Math.min(elementWidth, elementHeight);\n\n    const margin = {\n      top: 0.25 * this.rem,\n      bottom: 0.25 * this.rem,\n      left: 0.25 * this.rem,\n      right: 0.25 * this.rem,\n    };\n    const height = elementSize - (margin.top + margin.bottom);\n    const width = elementSize - (margin.left + margin.right);\n\n    // X Scale\n    this.xScale = d3.scaleLinear()\n      .domain([-1, 1])\n      .range([0, width]);\n\n    // Y Scale\n    this.yScale = d3.scaleLinear()\n      .domain([1, -1])\n      .range([0, height]);\n\n    // Svg\n    //  DATA-JOIN\n    const svgUpdate = d3.select(this.renderRoot).selectAll('.main')\n      .data([{\n        width: this.width,\n        height: this.height,\n        rem: this.rem,\n      }]);\n    //  ENTER\n    const svgEnter = svgUpdate.enter().append('svg')\n      .classed('main', true);\n    //  MERGE\n    const svgMerge = svgEnter.merge(svgUpdate)\n      .attr('viewBox', `0 0 ${elementSize} ${elementSize}`);\n\n    // Clippath\n    //  ENTER\n    svgEnter.append('clipPath')\n      .attr('id', 'clip-rdk-task')\n      .append('circle');\n    //  MERGE\n    svgMerge.select('clipPath circle')\n      .attr('cx', this.xScale(0))\n      .attr('cy', this.yScale(0))\n      .attr('r', this.xScale(1) - this.xScale(0));\n\n    // Plot\n    //  ENTER\n    const plotEnter = svgEnter.append('g')\n      .classed('plot', true);\n    //  MERGE\n    const plotMerge = svgMerge.select('.plot')\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    // Underlayer\n    //  ENTER\n    const underlayerEnter = plotEnter.append('g')\n      .classed('underlayer', true);\n    // MERGE\n    const underlayerMerge = plotMerge.select('.underlayer');\n\n    // Background\n    //  ENTER\n    underlayerEnter.append('circle')\n      .classed('background', true);\n    //  MERGE\n    underlayerMerge.select('.background')\n      .attr('cx', this.xScale(0))\n      .attr('cy', this.yScale(0))\n      .attr('r', this.xScale(1) - this.xScale(0));\n\n    // Content\n    //  ENTER\n    plotEnter.append('g')\n      .classed('content', true)\n      .attr('clip-path', 'url(#clip-rdk-task)');\n    //  MERGE\n    const contentMerge = plotMerge.select('.content');\n\n    // Dot Groups\n    //  DATA-JOIN\n    const dotsUpdate = contentMerge.selectAll('.dots')\n      .data([[], []]);\n    //  ENTER\n    dotsUpdate.enter().append('g')\n      .classed('dots', true)\n      .classed('coherent', (datum, index) => { return index === this.COHERENT; })\n      .classed('random', (datum, index) => { return index === this.RANDOM; });\n\n    // Overlayer\n    //  ENTER\n    const overlayerEnter = plotEnter.append('g')\n      .classed('overlayer', true);\n    // MERGE\n    const overlayerMerge = plotMerge.select('.overlayer');\n\n    // Outline\n    //  ENTER\n    overlayerEnter.append('circle')\n      .classed('outline', true);\n    //  MERGE\n    overlayerMerge.select('.outline')\n      .attr('cx', this.xScale(0))\n      .attr('cy', this.yScale(0))\n      .attr('r', this.xScale(1) - this.yScale(0));\n\n    // Start or stop trial block\n    if (changedProperties.has('running')) {\n      if (this.running) {\n        // (Re)Start\n        if (this.pauseTime) {\n          // Shift timeline forward as if paused time never happened\n          this.baseTime += (d3.now() - this.pauseTime);\n          this.pauseTime = 0;\n        }\n        this.runner = d3.interval(this.run.bind(this), 20); // FIXME??\n      } else if (this.runner !== undefined) {\n        // Pause\n        this.runner.stop();\n        this.pauseTime = d3.now();\n      }\n    }\n  }\n\n  reset() {\n    this.runner.stop();\n    this.running = false;\n    this.trial = 0;\n    this.state = 'resetted';\n    this.baseTime = 0;\n    this.pauseTime = 0;\n    this.startTime = 0;\n    this.lastTime = 0;\n    this.signal = undefined;\n    this.currentDirection = undefined;\n\n    const dotsUpdate = d3.select(this.renderRoot).select('.content').selectAll('.dots')\n      .data([[], []]);\n    const dotUpdate = dotsUpdate.selectAll('.dot')\n      .data((datum) => { return datum; });\n    dotUpdate.exit()\n      .remove();\n\n    const fixationUpdate = d3.select(this.renderRoot).select('.content').selectAll('.fixation')\n      .data([]);\n    fixationUpdate.exit()\n      .remove();\n    const queryUpdate = d3.select(this.renderRoot).select('.content').selectAll('.query')\n      .data([]);\n    queryUpdate.exit()\n      .remove();\n  }\n\n  run(/* elapsed */) {\n    const realTime = d3.now();\n    const currentTime = (this.baseTime) ? (realTime - this.baseTime) : 0;\n    const elapsedTime = (this.baseTime) ? (currentTime - this.startTime) : 0;\n    const frameTime = (this.baseTime) ? (currentTime - this.lastTime) : 0;\n    this.lastTime = currentTime;\n    let newTrial = false;\n    if (this.state === 'resetted') {\n      // Start block with an ITI\n      this.state = 'iti';\n      this.baseTime = realTime;\n      this.startTime = 0;\n      this.dispatchEvent(new CustomEvent('rdk-block-start', {\n        detail: {\n          trials: this.trials,\n        },\n        bubbles: true,\n      }));\n    } else if ((this.state === 'iti') && (elapsedTime >= this.iti)) {\n      // Start new trial with a stimulus\n      newTrial = true;\n      this.trial += 1;\n      this.state = 'stimulus';\n      this.startTime = currentTime;\n      this.signal = (Math.random() < this.probability) ? 'present' : 'absent';\n      this.currentDirection = (this.signal === 'absent')\n        ? undefined\n        : (this.direction >= 0)\n          ? this.direction\n          : (Math.random() * 360);\n      this.dispatchEvent(new CustomEvent('rdk-trial-start', {\n        detail: {\n          trials: this.trials,\n          duration: this.duration,\n          wait: this.wait,\n          iti: this.iti,\n          trial: this.trial,\n          signal: this.signal,\n        },\n        bubbles: true,\n      }));\n    } else if ((this.state === 'stimulus') && (elapsedTime >= this.duration)) {\n      // Stimulus is over, now wait\n      this.state = 'wait';\n      this.startTime = currentTime;\n      this.dispatchEvent(new CustomEvent('rdk-trial-middle', {\n        detail: {\n          trials: this.trials,\n          duration: this.duration,\n          wait: this.wait,\n          iti: this.iti,\n          trial: this.trial,\n          signal: this.signal,\n        },\n        bubbles: true,\n      }));\n    } else if ((this.state === 'wait') && (elapsedTime >= this.wait)) {\n      // Wait is over, end of trial\n      this.dispatchEvent(new CustomEvent('rdk-trial-end', {\n        detail: {\n          trials: this.trials,\n          duration: this.duration,\n          wait: this.wait,\n          iti: this.iti,\n          trial: this.trial,\n          signal: this.signal,\n        },\n        bubbles: true,\n      }));\n      if (this.trial >= this.trials) {\n        // End of block\n        this.runner.stop();\n        this.running = false;\n        this.state = 'ended';\n        this.baseTime = 0;\n        this.pauseTime = 0;\n        this.startTime = 0;\n        this.lastTime = 0;\n        this.signal = undefined;\n        this.currentDirection = undefined;\n        this.dispatchEvent(new CustomEvent('rdk-block-end', {\n          detail: {\n            trials: this.trial,\n          },\n          bubbles: true,\n        }));\n      } else {\n        // ITI\n        this.state = 'iti';\n        this.startTime = currentTime;\n      }\n    }\n\n    // Dots\n    if (this.state === 'stimulus') {\n      this.dots[this.COHERENT].length = (this.signal === 'present') ? Math.round(this.count * this.coherence) : 0;\n      this.dots[this.RANDOM].length = (this.signal === 'present') ? (this.count - this.dots[this.COHERENT].length) : this.count;\n\n      for (let t = 0; t < this.dots.length; t += 1) {\n        for (let i = 0; i < this.dots[t].length; i += 1) {\n          const newDot = (this.dots[t][i] === undefined);\n          if (newDot) {\n            this.dots[t][i] = {};\n          }\n          const dot = this.dots[t][i];\n          if (newTrial || newDot) {\n            dot.direction = (t === this.RANDOM) ? (Math.random() * 360) : this.currentDirection;\n            dot.birth = currentTime - Math.floor(Math.random() * this.lifetime);\n            const angle = Math.random() * 2 * Math.PI;\n            const radius = Math.sqrt(Math.random());\n            dot.x = this.xScale(radius * Math.cos(angle));\n            dot.y = this.yScale(radius * Math.sin(angle));\n          } else if (currentTime > (dot.birth + this.lifetime)) {\n            // Dot has died, so rebirth\n            dot.birth += this.lifetime;\n            dot.direction = (t === this.RANDOM) ? (Math.random() * 360) : this.currentDirection;\n            const angle = Math.random() * 2 * Math.PI;\n            const radius = Math.sqrt(Math.random());\n            dot.x = this.xScale(radius * Math.cos(angle));\n            dot.y = this.yScale(radius * Math.sin(angle));\n          } else {\n            if (t === this.COHERENT) {\n              dot.direction = this.currentDirection;\n            }\n            const directionR = dot.direction * (Math.PI / 180);\n            dot.dx = this.speed * (frameTime / 1000) * Math.cos(directionR);\n            dot.dy = this.speed * (frameTime / 1000) * Math.sin(directionR);\n            // Update position\n            dot.x += dot.dx;\n            dot.y += dot.dy;\n            // Calculate squared distance from center\n            const distance2 = ((dot.x - this.xScale(0)) ** 2) + ((dot.y - this.yScale(0)) ** 2);\n            const radius2 = (this.xScale(1) - this.xScale(0)) ** 2;\n            if (distance2 > radius2) {\n              // Dot has exited so move to other side\n              dot.x = -(dot.x - this.xScale(0)) + this.xScale(0);\n              dot.y = -(dot.y - this.yScale(0)) + this.yScale(0);\n            }\n          }\n        }\n      }\n    }\n\n    // Fixation\n    //  DATA-JOIN\n    const fixationUpdate = d3.select(this.renderRoot).select('.content').selectAll('.fixation')\n      .data((this.state === 'iti') ? [true] : []);\n    //  ENTER\n    const fixationEnter = fixationUpdate.enter().append('g')\n      .classed('fixation', true);\n    fixationEnter.append('line')\n      .attr('x1', this.xScale(-0.1))\n      .attr('y1', this.xScale(0))\n      .attr('x2', this.xScale(0.1))\n      .attr('y2', this.xScale(0));\n    fixationEnter.append('line')\n      .attr('x1', this.xScale(0))\n      .attr('y1', this.xScale(-0.1))\n      .attr('x2', this.xScale(0))\n      .attr('y2', this.xScale(0.1));\n    //  EXIT\n    fixationUpdate.exit().remove();\n\n    // Dots\n    //  DATA-JOIN\n    const dotsUpdate = d3.select(this.renderRoot).select('.content').selectAll('.dots')\n      .data((this.state === 'stimulus') ? this.dots : [[], []]);\n    const dotUpdate = dotsUpdate.selectAll('.dot')\n      .data((datum) => { return datum; });\n    //  ENTER\n    const dotEnter = dotUpdate.enter().append('circle')\n      .classed('dot', true)\n      .attr('r', 2); /* HACK: Firefox does not support CSS SVG Geometry Properties */\n    //  MERGE\n    dotEnter.merge(dotUpdate)\n      .attr('cx', (datum) => { return datum.x; })\n      .attr('cy', (datum) => { return datum.y; });\n    //  EXIT\n    dotUpdate.exit().remove();\n\n    // Query\n    //  DATA-JOIN\n    const queryUpdate = d3.select(this.renderRoot).select('.content').selectAll('.query')\n      .data((this.state === 'wait') ? [true] : []);\n    //  ENTER\n    const queryEnter = queryUpdate.enter().append('g')\n      .classed('query', true);\n    queryEnter.append('text')\n      .attr('x', this.xScale(0))\n      .attr('y', this.xScale(0))\n      .attr('text-anchor', 'middle')\n      .attr('alignment-baseline', 'middle')\n      .text('?');\n    //  EXIT\n    queryUpdate.exit().remove();\n  }\n}\n\ncustomElements.define('rdk-task', RDKTask);\n"],"file":"rdk-task.js"}