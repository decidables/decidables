{"version":3,"file":"accumulableMath.umd.min.js","sources":["../src/ddm-math.js"],"sourcesContent":["\n/*\n  DDMMath Static Class - Not intended for instantiation!\n\n  Model parameters:\n    a = boundary separation\n    z = starting point as a proportion of a\n    v = drift rate (per second)\n    t0 = non-decision time (in milliseconds)\n    s = within-trial variability in drift rate (s^2 = infinitesimal variance)\n\n    zPrime = starting point on a 0-to-a scale (typically used in published equations)\n\n  Behavioral variables:\n    pE = proportion of error trials\n    pC = proportion of correct trials\n    m = mean of overall RTs (in milliseconds)\n    mE = mean of error RTs (in milliseconds)\n    mC = mean correct RTs (in milliseconds)\n    sd = standard deviation of overall RTs (in milliseconds)\n    sdE = standard deviation of error RTs (in milliseconds)\n    sdC = standard deviation of correct RTs (in milliseconds)\n\n  Equations:\n    Probability of correct and error responses (Alexandrowicz, 2020)\n    Mean of overall, error, and correct RTs (Grasman et al., 2009)\n    Standard deviation of overall, error, and correct RTs (Grasman et al., 2009)\n    Density of error and correct RT distributions (Alexandrowicz, 2020)\n*/\nexport default class DDMMath {\n  static s = 1;\n\n  // Calculate a bunch of statistics for an array of trials\n  static trials2stats(trials) {\n    const stats = trials.reduce(\n      (accumulator, trial) => {\n        switch (trial.outcome) {\n          case 'correct':\n            accumulator.trials.correct += 1;\n            accumulator.rts.correct += trial.rt;\n            break;\n          case 'error':\n            accumulator.trials.error += 1;\n            accumulator.rts.error += trial.rt;\n            break;\n          case 'nr':\n            accumulator.trials.nr += 1;\n            break;\n          default:\n            // No-op\n        }\n        return accumulator;\n      },\n      {\n        trials: {\n          total: 0,\n          correct: 0,\n          error: 0,\n          nr: 0,\n        },\n        rts: {\n          overall: 0,\n          correct: 0,\n          error: 0,\n        },\n        sss: {\n          overall: 0,\n          correct: 0,\n          error: 0,\n        },\n      },\n    );\n\n    stats.trials.total = stats.trials.correct + stats.trials.error + stats.trials.nr;\n    stats.rts.overall = stats.rts.correct + stats.rts.error;\n\n    stats.proportion = {\n      correct: stats.trials.correct / stats.trials.total,\n      error: stats.trials.error / stats.trials.total,\n      nr: stats.trials.nr / stats.trials.total,\n    };\n\n    stats.meanRT = {\n      overall: stats.rts.overall / (stats.trials.correct + stats.trials.error),\n      correct: stats.rts.correct / stats.trials.correct,\n      error: stats.rts.error / stats.trials.error,\n    };\n\n    trials.reduce(\n      (accumulator, trial) => {\n        accumulator.sss.overall += (trial.rt - accumulator.meanRT.overall) ** 2;\n        switch (trial.outcome) {\n          case 'correct':\n            accumulator.sss.correct += (trial.rt - accumulator.meanRT.correct) ** 2;\n            break;\n          case 'error':\n            accumulator.sss.error += (trial.rt - accumulator.meanRT.error) ** 2;\n            break;\n          default:\n            // No-op\n        }\n        return accumulator;\n      },\n      stats,\n    );\n\n    stats.sdRT = {\n      overall: Math.sqrt(stats.sss.overall / (stats.trials.correct + stats.trials.error - 1)),\n      correct: Math.sqrt(stats.sss.correct / (stats.trials.correct - 1)),\n      error: Math.sqrt(stats.sss.error / (stats.trials.error - 1)),\n    };\n\n    return stats;\n  }\n\n  // Probability of an Error Response\n  static azvs2pE(a, z, v, s = DDMMath.s) {\n    const zPrime = a * z;\n\n    const A = Math.exp((-2 * v * a) / s ** 2);\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2);\n\n    return (A - Z) / (A - 1);\n  }\n\n  // Probability of a Correct Response\n  static azvs2pC(a, z, v, s = DDMMath.s) {\n    return DDMMath.azvs2pE(a, 1 - z, -v, s);\n  }\n\n  // Mean Overall RT\n  // Equation 5 (Grasman et al., 2009)\n  static azvt0s2m(a, z, v, t0, s = DDMMath.s) {\n    const zPrime = a * z;\n    const A = Math.exp((-2 * v * a) / s ** 2) - 1;\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2) - 1;\n\n    const mean = -(zPrime / v) + (a / v) * (Z / A);\n    return t0 + mean * 1000;\n  }\n\n  // SD Overall RT\n  // Equation 6 (Grasman et al., 2009)\n  static azvs2sd(a, z, v, s = DDMMath.s) {\n    const zPrime = a * z;\n    const A = Math.exp((-2 * v * a) / s ** 2) - 1;\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2) - 1;\n\n    const variance = (\n      (\n        (-v * a ** 2 * (Z + 4) * Z) / A ** 2\n      ) + (\n        ((-3 * v * a ** 2 + 4 * v * zPrime * a + s ** 2 * a) * Z + 4 * v * zPrime * a) / A\n      ) - (\n        s ** 2 * zPrime\n      )\n    ) / v ** 3;\n\n    return Math.sqrt(variance) * 1000;\n  }\n\n  // Mean Error RT\n  // Equation 13 (Grasman et al., 2009)\n  static azvt0s2mE(a, z, v, t0, s = DDMMath.s) {\n    function phi(x, y) {\n      return Math.exp((2 * v * y) / (s ** 2)) - Math.exp((2 * v * x) / (s ** 2));\n    }\n    const zPrime = a * z;\n\n    const mean = (zPrime * (phi(zPrime - a, a) + phi(0, zPrime)) + 2 * a * phi(zPrime, 0))\n      / (v * phi(zPrime, a) * phi(-a, 0));\n    return t0 + mean * 1000;\n  }\n\n  // SD Error RT\n  // Equation 14 (Grasman et al., 2009)\n  static azvs2sdE(a, z, v, s = DDMMath.s) {\n    function phi(x, y) {\n      return Math.exp((2 * v * y) / (s ** 2)) - Math.exp((2 * v * x) / (s ** 2));\n    }\n    const zPrime = a * z;\n\n    const variance = (\n      (\n        -2 * a * phi(0, zPrime)\n        * ((2 * v * a * phi(zPrime, 2 * a)) + (s ** 2 * phi(0, a) * phi(zPrime, a)))\n        * Math.exp((2 * v * a) / s ** 2)\n      ) / (\n        v ** 3 * phi(0, a) ** 2 * phi(zPrime, a) ** 2\n      )\n    ) + (\n      (\n        4 * v * zPrime * (2 * a - zPrime) * Math.exp((2 * v * (zPrime + a)) / s ** 2)\n        + zPrime * s ** 2 * phi(2 * zPrime, 2 * a)\n      ) / (\n        v ** 3 * phi(zPrime, a) ** 2\n      )\n    );\n\n    return Math.sqrt(variance) * 1000;\n  }\n\n  // Mean Correct RT\n  static azvt0s2mC(a, z, v, t0, s = DDMMath.s) {\n    return DDMMath.azvt0s2mE(a, 1 - z, -v, t0, s);\n  }\n\n  // SD Correct RT\n  static azvs2sdC(a, z, v, s = DDMMath.s) {\n    return DDMMath.azvs2sdE(a, 1 - z, -v, s);\n  }\n\n  // Density of Error RT\n  static tazvs2gE(t, a, z, v, s = DDMMath.s) {\n    if (!t) return 0;\n\n    const zPrime = a * z;\n    const base = ((Math.PI * s ** 2) / a ** 2) * Math.exp((-zPrime * v) / s ** 2);\n\n    let k = 0;\n    let term = 0;\n    let sum = 0;\n    do {\n      k += 1;\n\n      term = k\n        * Math.sin((Math.PI * zPrime * k) / a)\n        * Math.exp(-0.5 * ((v ** 2 / s ** 2) + ((Math.PI ** 2 * k ** 2 * s ** 2) / a ** 2)) * t);\n\n      sum += term;\n    } while (k < 200); // ?? HACK\n\n    return base * sum;\n  }\n\n  // Density of Correct RT\n  static tazvs2gC(t, a, z, v, s = DDMMath.s) {\n    return DDMMath.tazvs2gE(t, a, 1 - z, -v, s);\n  }\n}\n"],"names":["DDMMath","static","trials2stats","trials","stats","reduce","accumulator","trial","outcome","correct","rts","rt","error","nr","total","overall","sss","proportion","meanRT","sdRT","Math","sqrt","azvs2pE","a","z","v","s","zPrime","A","exp","azvs2pC","azvt0s2m","t0","azvs2sd","Z","variance","azvt0s2mE","phi","x","y","azvs2sdE","azvt0s2mC","azvs2sdC","tazvs2gE","t","base","PI","k","term","sum","sin","tazvs2gC"],"mappings":"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"}