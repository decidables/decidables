{"version":3,"file":"accumulableMath.esm.min.js","sources":["../src/ddm-math.js"],"sourcesContent":["\n/*\n  DDMMath Static Class - Not intended for instantiation!\n\n  Model parameters:\n    a = boundary separation\n    z = starting point as a proportion of a\n    v = drift rate (per second)\n    t0 = non-decision time (in milliseconds)\n    s = within-trial variability in drift rate (s^2 = infinitesimal variance)\n\n    zPrime = starting point on a 0-to-a scale (typically used in published equations)\n\n  Behavioral variables:\n    pE = proportion of error trials\n    pC = proportion of correct trials\n    m = mean of overall RTs (in milliseconds)\n    mE = mean of error RTs (in milliseconds)\n    mC = mean correct RTs (in milliseconds)\n    sd = standard deviation of overall RTs (in milliseconds)\n    sdE = standard deviation of error RTs (in milliseconds)\n    sdC = standard deviation of correct RTs (in milliseconds)\n\n  Equations:\n    Probability of correct and error responses (Alexandrowicz, 2020)\n    Mean of overall, error, and correct RTs (Grasman et al., 2009)\n    Standard deviation of overall, error, and correct RTs (Grasman et al., 2009)\n    Density of error and correct RT distributions (Alexandrowicz, 2020)\n    EZ-diffusion model (Wagenmakers et al., 2007)\n*/\nexport default class DDMMath {\n  static s = 1;\n\n  // Calculate a bunch of statistics for an array of trials\n  static trials2stats(trials) {\n    const stats = {};\n\n    // First-order sums\n    const sums = trials.reduce(\n      (accumulator, trial) => {\n        switch (trial.outcome) {\n          case 'correct':\n            accumulator.correctCount += 1;\n            accumulator.correctRTSum += trial.rt;\n            break;\n          case 'error':\n            accumulator.errorCount += 1;\n            accumulator.errorRTSum += trial.rt;\n            break;\n          case 'nr':\n            accumulator.nrCount += 1;\n            break;\n          default:\n            // No-op\n        }\n        return accumulator;\n      },\n      {\n        correctCount: 0,\n        errorCount: 0,\n        nrCount: 0,\n\n        correctRTSum: 0,\n        errorRTSum: 0,\n      },\n    );\n\n    // First-order stats\n    stats.correctCount = sums.correctCount;\n    stats.errorCount = sums.errorCount;\n    stats.nrCount = sums.nrCount;\n    stats.accuracy = sums.correctCount / (sums.correctCount + sums.errorCount + sums.nrCount);\n\n    stats.correctMeanRT = sums.correctRTSum / sums.correctCount;\n    stats.errorMeanRT = sums.errorRTSum / sums.errorCount;\n    stats.meanRT = (sums.correctRTSum + sums.errorRTSum) / (sums.correctCount + sums.errorCount);\n\n    // Second-order sums\n    const sums2 = trials.reduce(\n      (accumulator, trial) => {\n        switch (trial.outcome) {\n          case 'correct':\n            accumulator.ss += (trial.rt - stats.meanRT) ** 2;\n            accumulator.correctSS += (trial.rt - stats.correctMeanRT) ** 2;\n            break;\n          case 'error':\n            accumulator.ss += (trial.rt - stats.meanRT) ** 2;\n            accumulator.errorSS += (trial.rt - stats.errorMeanRT) ** 2;\n            break;\n          default:\n            // No-op\n        }\n        return accumulator;\n      },\n      {\n        ss: 0,\n        correctSS: 0,\n        errorSS: 0,\n      },\n    );\n\n    // Second-order stats\n    stats.correctSDRT = (stats.correctCount > 1)\n      ? Math.sqrt(sums2.correctSS / (stats.correctCount - 1))\n      : NaN;\n    stats.errorSDRT = (stats.errorCount > 1)\n      ? Math.sqrt(sums2.errorSS / (stats.errorCount - 1))\n      : NaN;\n    stats.sdRT = (stats.correctCount + stats.errorCount > 1)\n      ? Math.sqrt(sums2.ss / (stats.correctCount + stats.errorCount - 1))\n      : NaN;\n\n    return stats;\n  }\n\n  // Probability of an Error Response\n  static azv2pE(a, z, v, s = DDMMath.s) {\n    const zPrime = a * z;\n\n    const A = Math.exp((-2 * v * a) / s ** 2);\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2);\n\n    return (A - Z) / (A - 1);\n  }\n\n  // Probability of a Correct Response\n  static azv2pC(a, z, v, s = DDMMath.s) {\n    return DDMMath.azv2pE(a, 1 - z, -v, s);\n  }\n\n  // Mean Overall RT\n  // Equation 5 (Grasman et al., 2009)\n  static azvt02m(a, z, v, t0, s = DDMMath.s) {\n    const zPrime = a * z;\n    const A = Math.exp((-2 * v * a) / s ** 2) - 1;\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2) - 1;\n\n    const mean = -(zPrime / v) + (a / v) * (Z / A);\n    return t0 + mean * 1000;\n  }\n\n  // SD Overall RT\n  // Equation 6 (Grasman et al., 2009)\n  static azv2sd(a, z, v, s = DDMMath.s) {\n    const zPrime = a * z;\n    const A = Math.exp((-2 * v * a) / s ** 2) - 1;\n    const Z = Math.exp((-2 * v * zPrime) / s ** 2) - 1;\n\n    const variance = (\n      (\n        (-v * a ** 2 * (Z + 4) * Z) / A ** 2\n      ) + (\n        ((-3 * v * a ** 2 + 4 * v * zPrime * a + s ** 2 * a) * Z + 4 * v * zPrime * a) / A\n      ) - (\n        s ** 2 * zPrime\n      )\n    ) / v ** 3;\n\n    return Math.sqrt(variance) * 1000;\n  }\n\n  // Mean Error RT\n  // Equation 13 (Grasman et al., 2009)\n  static azvt02mE(a, z, v, t0, s = DDMMath.s) {\n    function phi(x, y) {\n      return Math.exp((2 * v * y) / (s ** 2)) - Math.exp((2 * v * x) / (s ** 2));\n    }\n    const zPrime = a * z;\n\n    const mean = (zPrime * (phi(zPrime - a, a) + phi(0, zPrime)) + 2 * a * phi(zPrime, 0))\n      / (v * phi(zPrime, a) * phi(-a, 0));\n    return t0 + mean * 1000;\n  }\n\n  // SD Error RT\n  // Equation 14 (Grasman et al., 2009)\n  static azv2sdE(a, z, v, s = DDMMath.s) {\n    function phi(x, y) {\n      return Math.exp((2 * v * y) / (s ** 2)) - Math.exp((2 * v * x) / (s ** 2));\n    }\n    const zPrime = a * z;\n\n    const variance = (\n      (\n        -2 * a * phi(0, zPrime)\n        * ((2 * v * a * phi(zPrime, 2 * a)) + (s ** 2 * phi(0, a) * phi(zPrime, a)))\n        * Math.exp((2 * v * a) / s ** 2)\n      ) / (\n        v ** 3 * phi(0, a) ** 2 * phi(zPrime, a) ** 2\n      )\n    ) + (\n      (\n        4 * v * zPrime * (2 * a - zPrime) * Math.exp((2 * v * (zPrime + a)) / s ** 2)\n        + zPrime * s ** 2 * phi(2 * zPrime, 2 * a)\n      ) / (\n        v ** 3 * phi(zPrime, a) ** 2\n      )\n    );\n\n    return Math.sqrt(variance) * 1000;\n  }\n\n  // Mean Correct RT\n  static azvt02mC(a, z, v, t0, s = DDMMath.s) {\n    return DDMMath.azvt02mE(a, 1 - z, -v, t0, s);\n  }\n\n  // SD Correct RT\n  static azv2sdC(a, z, v, s = DDMMath.s) {\n    return DDMMath.azv2sdE(a, 1 - z, -v, s);\n  }\n\n  // Density of Error RT\n  static tazv2gE(t, a, z, v, s = DDMMath.s) {\n    if (!t) return 0;\n\n    const zPrime = a * z;\n    const base = ((Math.PI * s ** 2) / a ** 2) * Math.exp((-zPrime * v) / s ** 2);\n\n    let k = 0;\n    let term = 0;\n    let sum = 0;\n    do {\n      k += 1;\n\n      term = k\n        * Math.sin((Math.PI * zPrime * k) / a)\n        * Math.exp(-0.5 * ((v ** 2 / s ** 2) + ((Math.PI ** 2 * k ** 2 * s ** 2) / a ** 2)) * t);\n\n      sum += term;\n    } while (k < 200); // ?? HACK\n\n    return base * sum;\n  }\n\n  // Density of Correct RT\n  static tazv2gC(t, a, z, v, s = DDMMath.s) {\n    return DDMMath.tazv2gE(t, a, 1 - z, -v, s);\n  }\n\n  // Adapted from https://raoul.socsci.uva.nl/EZ2/EZ2_new.html\n  // EZ-function for starting values\n  // input: obj - Object with properties\n  //    pC - Proportion correct\n  //    sd - sample standard deviation of the RT's in ms\n  //    m - sample mean of the RT's in ms\n  //    s - diffusion standard deviation\n  // returns: Object with properties v, a, and t0, containing EZ-estimates of these parameters\n  static data2ez({\n    accuracy: pC,\n    sdRT: sd,\n    meanRT: m,\n    s,\n  }) {\n    function sign(r) {\n      return ((r > 0) ? 1 : ((r === 0) ? 0 : -1));\n    }\n\n    function logit(p) {\n      return Math.log(p / (1 - p));\n    }\n\n    const vrt = (sd / 1000) ** 2;\n    const mrt = m / 1000;\n\n    const s2 = s ** 2;\n    const l = logit(pC);\n    const x = (l * (l * pC ** 2 - l * pC + pC - 0.5)) / vrt;\n    const v = sign(pC - 0.5) * s * x ** (1 / 4);\n    const a = (s2 * logit(pC)) / v;\n    const y = (-v * a) / s2;\n    const mdt = ((a / (2 * v)) * (1 - Math.exp(y))) / (1 + Math.exp(y));\n    const t0 = (mrt ? mrt - mdt : null); // compute Ter only if MRT was provided\n\n    const t0Prime = t0 * 1000;\n    return {\n      v,\n      a,\n      t0: t0Prime,\n      s,\n    };\n  }\n\n  static data2ez2() {\n    throw new Error('data2ez2 is not implemented!');\n  }\n}\n"],"names":["DDMMath","static","trials2stats","trials","stats","sums","reduce","accumulator","trial","outcome","correctCount","correctRTSum","rt","errorCount","errorRTSum","nrCount","accuracy","correctMeanRT","errorMeanRT","meanRT","sums2","ss","correctSS","errorSS","correctSDRT","Math","sqrt","NaN","errorSDRT","sdRT","azv2pE","a","z","v","s","zPrime","A","exp","azv2pC","azvt02m","t0","azv2sd","Z","variance","azvt02mE","phi","x","y","azv2sdE","azvt02mC","azv2sdC","tazv2gE","t","base","PI","k","term","sum","sin","tazv2gC","data2ez","pC","sd","m","logit","p","log","vrt","mrt","s2","l","r","mdt","data2ez2","Error"],"mappings":"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"}